/*
 * Ejemplo desarrollado por Erick Navarro
 * Blog: e-navarro.blogspot.com
 * Julio - 2018
 */

package analizadores; 
import java_cup.runtime.*;
import Utils.ResultadoParser;

parser code
{:
    private ResultadoParser resultadoParser;
    
    public void setResultadoParser(ResultadoParser resultadoParser){
        this.resultadoParser = resultadoParser;
    }

    /**
     * Método al que se llama automáticamente ante algún error sintactico.
     **/ 
    public void syntax_error(Symbol s){ 
        System.out.println("Error Sintáctico en la Línea " + (s.left) +
        " Columna "+s.right+ ". No se esperaba este componente: " +s.value+".");
        resultadoParser.setMensaje("Error Sintáctico en la Línea " + (s.left) +
        " Columna "+s.right+ ". No se esperaba este componente: " +s.value+"\n");
    } 

    /**
     * Método al que se llama automáticamente ante algún error sintáctico 
     * en el que ya no es posible una recuperación de errores.
     **/ 
    public void unrecovered_syntax_error(Symbol s) throws java.lang.Exception{ 
        System.out.println("Error síntactico irrecuperable en la Línea " + 
        (s.left)+ " Columna "+s.right+". Componente " + s.value + 
        " no reconocido."); 
        resultadoParser.setMensaje("Error síntactico irrecuperable en la Línea " + 
        (s.left)+ " Columna "+s.right+". Componente " + s.value + 
        " no reconocido."+"\n");
    }  
:} 

terminal String PTCOMA,DPUNTOS,PARIZQ,PARDER,CORIZQ,CORDER,LLAVDER,LLAVIZQ,COMA,PUNTO,DECRANGO;
terminal String EXCLAMACION,BARRA,COMILLAS,NUMERAL,DOLAR,PORC,AMPER,COMSIMPLE,MAYORQUE,MENORQUE,IGUAL,INTER,ACENTO,ORSIGN,GUIONB;
terminal String IDENTIFICADOR;
terminal String LETRA;
terminal String MAS,MENOS,POR,DIVIDIDO;
terminal String ENTERO;
terminal String DECIMAL;
terminal String UMENOS;
terminal String REVALUAR,INICONJUNTO,ASIGN;

non terminal ini;
non terminal instrucciones;
non terminal deconjunto;
non terminal valoresconjunto,listavalores;
non terminal instruccion;
non terminal signos;
non terminal regex,terminos,unavar,multvar,decregex;
non terminal Double expresion;


precedence left MAS,MENOS;
precedence left POR,DIVIDIDO;
precedence right UMENOS; 

start with ini; 

ini::=instrucciones{:resultadoParser.setMensaje("COMPILADO CORRECTAMENTE :)");:};

instrucciones ::= 
   instruccion instrucciones
 | instruccion
 | error instrucciones
; 

instruccion ::= 
   LLAVIZQ deconjunto decregex LLAVDER
;

deconjunto ::=
      deconjunto INICONJUNTO DPUNTOS IDENTIFICADOR ASIGN valoresconjunto PTCOMA {::}
    | deconjunto INICONJUNTO DPUNTOS IDENTIFICADOR ASIGN listavalores PTCOMA {::}
    | INICONJUNTO DPUNTOS IDENTIFICADOR ASIGN valoresconjunto PTCOMA {::}
    | INICONJUNTO DPUNTOS IDENTIFICADOR ASIGN listavalores PTCOMA {::}
;

decregex ::=
      decregex IDENTIFICADOR ASIGN regex PTCOMA
    | IDENTIFICADOR ASIGN regex PTCOMA
;

regex ::=
        multvar regex regex
    |   unavar regex
    |   PARIZQ multvar regex regex PARDER
    |   PARIZQ unavar regex PARDER
    |   terminos
    |   expresion
    |   COMILLAS signos COMILLAS
;

terminos ::=
        IDENTIFICADOR
    |   PARIZQ IDENTIFICADOR PARDER
    |   GUIONB
    |   PARIZQ GUIONB PARDER
;

unavar ::=
        POR
    |   MAS
    |   INTER
;

multvar ::=
        PUNTO
    |   ORSIGN
;

valoresconjunto ::=
    expresion DECRANGO expresion
    |signos DECRANGO signos
;

listavalores ::=
      listavalores COMA expresion
    | expresion
    | listavalores COMA signos
    | signos
;

expresion  ::= 
    ENTERO:a                               
 |  DECIMAL:a            
 |  LETRA:a                      
;
        
signos ::=
    EXCLAMACION
 |  COMILLAS
 |  NUMERAL
 |  DOLAR
 |  PORC
 |  AMPER
 |  COMSIMPLE
 |  PARIZQ
 |  PARDER
 |  POR
 |  MAS
 |  COMA
 |  MENOS
 |  PUNTO
 |  BARRA
 |  DPUNTOS
 |  PTCOMA
 |  MENORQUE
 |  MAYORQUE
 |  IGUAL
 |  INTER
 |  ACENTO
 |  ORSIGN
 |  LLAVIZQ
 |  LLAVDER
;